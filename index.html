<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>IT 355 - Chatroom - Thang and Larry</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Thang and Larry">
    <link href="./css/bootstrap.css" rel="stylesheet">
	<script src="/socket.io/socket.io.js"></script>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script type="text/javascript">
    	var socket = io.connect('/');
		var fullMessage = null;
    	socket.on('from server', function (data) {
    		console.log(data);
    		if (data['connect']) {
				fullMessage = data['fullMessage'];
				document.getElementById("messagebox").innerHTML = "Welcome to Larry and Thang's Chat Room!\n";
				for(var i = 0; i < fullMessage.length; i++){
					document.getElementById("messagebox").innerHTML += fullMessage[i];
				}
    		} 
    // 		else {
				// document.getElementById("messagebox").innerHTML = "******************************************************************\n";
				// document.getElementById("messagebox").innerHTML += "Sorry, this Chatroom is limited to " + data.online + " connections\n";
				// document.getElementById("messagebox").innerHTML += "There are currently " + data.online + " users online!\n";
				// document.getElementById("messagebox").innerHTML += "Connection Terminated !\n";
    // 			console.log("Warn: get no message from server");
    // 		}
    	});

  //   	function connectToServer() {
  //   		console.log("onload: connectToServer called");
		// var message = document.getElementById("messageinput").value;
  //   	var chatName = document.getElementById("userChatName").value;
  //   	var select = document.getElementById("selectroom");
  //   	var chatRoom = "room" + select.options[select.selectedIndex].value;

  //   		socket.emit('on connected', {message: "", chatName : chatName, chatRoom: chatRoom});
  //   	}
		
		function changeRoom() {
		var message = document.getElementById("messageinput").value;
    	var chatName = document.getElementById("userChatName").value;
    	var select = document.getElementById("selectroom");
    	var chatRoom = "room" + select.options[select.selectedIndex].value;

			//var message = "User " + chatname " just entered chatRoom " + chatRoom;
			socket.emit('from client', { message: "", chatName : chatName, chatRoom:  chatRoom});
		}
		
    	function sendRequest() {
		var message = document.getElementById("messageinput").value;
    	var chatName = document.getElementById("userChatName").value;
    	var select = document.getElementById("selectroom");
    	var chatRoom = "room" + select.options[select.selectedIndex].value;

    		
			socket.emit('from client', { message: message, chatName : chatName, chatRoom:  chatRoom});

    		// display the user's input message
			//for(var i = 0; i < fullMessage.length; i++){
			//		document.getElementById("messagebox").innerHTML += fullMessage[i];
			//}
    		//send the special chat request
    		// window.location = ;

    	}

		function gup(varname) {
			varname = varname.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
			var regexS = "[\\?&]"+varname+"=([^&#]*)";
			var regex = new RegExp( regexS );
			var results = regex.exec( window.location.href );
			if( results == null ) return ""; else return results[1];
		}
		
    </script>
  </head>
  <body onload="changeRoom()">
	<div class="container" style="margin-top: 20px;">
		<div class="row">
			<div class="span12 lead" style="padding: 10px; border-radius:5px; background-color:gray">
				<font color="gold"><center><b>Welcome to our HTTP Chatroom ! </b></center></font>
			</div>
			<div class="span12" style="padding: 10px; margin-top: 15px; background-color:gray; border-radius:5px;">
				<font color="white">
				<div id="main" style="margin-left: 200px">
					<div float:left>Select Chatroom:
						<select id="selectroom" onchange="changeRoom();">
						  <option value="1">Chatroom 1 (Default)</option>
						  <option value="2">Chatroom 2</option>
						  <option value="3">Chatroom 3 (VIP)</option>
						</select>
					</div>
					<div style="float:left">Your Chatname:
							<input type="text" id="userChatName"></input> 
					</div>
					<div style="float:left">
						Current Chatroom Content<br/>
						<textarea class="textarea" id="messagebox" readonly="readonly" rows="15" cols="90" style="overflow:auto; width:500px"></textarea>
					</div>
				    <div style="float:left">
						Send Content<br/>
						<textarea class="textarea" id="messageinput" rows="2" cols="90" style="overflow:auto; width:500px"></textarea>
						<div>
							<button type="button" class="btn btn-info" style="height: 35px; width: 150px" id="submitContent" onclick="sendRequest();">Submit</button>
							<button type="button" class="btn btn-warning" style="height: 35px; width: 150px" id="resetContent">Clear</button>
						</div>
					</div>
				</div>
				</select></font>
			</div>
		</div>	
	</div>
	
	<script src="./js/jquery.js"></script>
	<script src="./js/bootstrap.js"></script>
  </body>
</html>